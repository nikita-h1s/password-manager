{% extends "layout.html" %}
{% block content %}
<div class="">
    <main>
        <div class="user-settings-container">
            <h4 class="mb-3">Account settings</h4>

            <form class="needs-validation" novalidate>
                <div class="row g-3">
                    <!-- User Settings Form -->
                    <form id="user-settings-form">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" value="{{ user.username }}"
                               class="form-control">

                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" value="{{ user.email }}" class="form-control">

                        <hr class="my-4">

                        <!-- Additional settings -->
                        <div>Automatic Logout Time</div>
                        <select id="automatic-logout-time" name="automatic_logout_time" class="form-select">
                            <option value="30" {% if user.automatic_logout_time== 30 %}selected{% endif %}>30 min
                            </option>
                            <option value="60" {% if user.automatic_logout_time== 60 %}selected{% endif %}>1 hour
                            </option>
                            <option value="360" {% if user.automatic_logout_time== 360 %}selected{% endif %}>6 hours
                            </option>
                            <option value="1440" {% if user.automatic_logout_time== 1440 %}selected{% endif %}>24
                                hours
                            </option>
                        </select>

                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="show-passwords-by-default"
                                   name="show_passwords_by_default" {% if user.show_passwords_by_default %}checked{%
                                   endif %}>
                            <label class="form-check-label" for="show-passwords-by-default">
                                Show passwords by default
                            </label>
                        </div>

                        <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
                    </form>

                    <!-- 2FA Settings Form -->
                    <form method="POST" action="{{ url_for('auth.update_2fa') }}" id="2fa-form">
                        <input type="hidden" name="allow_2fa" value="off">
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="allow-2fa" name="allow_2fa"
                                   {% if user.status_2fa %}checked{% endif %}
                                   onchange="toggle2FA(this); submit2FAForm(this)">
                            <label class="form-check-label" for="allow-2fa">
                                Allow 2FA login
                            </label>
                        </div>
                    </form>

                    <!-- QR Code -->
                    <div id="qr-container" class="mt-3"
                         style="display: {% if user.status_2fa %}block{% else %}none{% endif %};">
                        <img class="qr-code-2fa" id="qr-code-2fa" src="{{ url_for('auth.generate_qr') }}"
                             alt="qr-code-2fa">
                    </div>
                </div>
            </form>


                <hr class="my-4">

                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="mt-3 ml-3 mr-3">
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category }} m-20 flash-message" role="alert">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endwith %}

<!--                <div class="d-flex align-items-center justify-content-between" id="deactivate">-->
<!--                    <div>-->
<!--                        <b>Deactivate your account</b>-->
<!--                        <p>Details about your account and passwords</p>-->
<!--                    </div>-->
<!--                    <div class="ml-auto">-->
<!--                        <button class="btn btn-outline-danger ml-5">Deactivate</button>-->
<!--                    </div>-->
<!--                </div>-->
        </div>
    </main>
</div>

<script>
    const user = {{ user | tojson }};
</script>

{% endblock content %}
